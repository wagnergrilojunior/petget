<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login - PetGet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug Login - PetGet</h1>
        
        <div class="info">
            <strong>Informa√ß√µes do Ambiente:</strong><br>
            <span id="env-info">Carregando...</span>
        </div>
        
        <div>
            <button onclick="testFetchDirect()">üß™ Testar fetch() direto</button>
            <button onclick="testAxiosDirect()">üß™ Testar axios direto</button>
            <button onclick="testCors()">üß™ Testar CORS</button>
            <button onclick="clearResult()">üßπ Limpar</button>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        // Configura√ß√µes
        const API_BASE_URL = 'http://localhost:8080/api';
        const LOGIN_ENDPOINT = `${API_BASE_URL}/auth/login`;
        const TEST_CREDENTIALS = {
            email: 'admin@clinicademo.com',
            senha: '123456'
        };

        // Elementos DOM
        const resultDiv = document.getElementById('result');
        const envInfo = document.getElementById('env-info');

        // Atualizar informa√ß√µes do ambiente
        function updateEnvInfo() {
            envInfo.innerHTML = `
                <strong>URL Base da API:</strong> ${API_BASE_URL}<br>
                <strong>Endpoint de Login:</strong> ${LOGIN_ENDPOINT}<br>
                <strong>Origem:</strong> ${window.location.origin}<br>
                <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 100)}...
            `;
        }

        // Mostrar resultado
        function showResult(content) {
            resultDiv.style.display = 'block';
            resultDiv.textContent = content;
            console.log('üìã Resultado:', content);
        }

        // Limpar resultado
        function clearResult() {
            resultDiv.style.display = 'none';
            resultDiv.textContent = '';
        }

        // Teste com fetch direto
        async function testFetchDirect() {
            showResult('üîÑ Testando fetch direto...');
            
            try {
                console.log('üß™ Iniciando teste fetch direto');
                console.log('üîß URL:', LOGIN_ENDPOINT);
                console.log('üîß Credenciais:', { ...TEST_CREDENTIALS, senha: '***' });
                
                const response = await fetch(LOGIN_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(TEST_CREDENTIALS)
                });
                
                console.log('üìä Response:', response);
                console.log('üìä Status:', response.status);
                console.log('üìä Headers:', [...response.headers.entries()]);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Dados recebidos:', data);
                    showResult(`‚úÖ SUCESSO com fetch()!\n\nStatus: ${response.status}\nURL: ${response.url}\nToken: ${data.accessToken ? 'Recebido' : 'N√£o recebido'}\nUsu√°rio: ${data.user?.nome || 'N√£o encontrado'}\n\nResposta completa:\n${JSON.stringify(data, null, 2)}`);
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå Erro HTTP:', response.status, errorText);
                    showResult(`‚ùå ERRO HTTP ${response.status}\n\nURL: ${response.url}\nStatus Text: ${response.statusText}\nResposta: ${errorText}`);
                }
            } catch (error) {
                console.error('üí• Erro de rede:', error);
                showResult(`üí• ERRO DE REDE\n\nTipo: ${error.name}\nMensagem: ${error.message}\nStack: ${error.stack}`);
            }
        }

        // Teste com axios direto
        async function testAxiosDirect() {
            showResult('üîÑ Testando axios direto...');
            
            try {
                console.log('üß™ Iniciando teste axios direto');
                
                // Configurar axios
                const axiosInstance = axios.create({
                    baseURL: API_BASE_URL,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                // Interceptor para logs
                axiosInstance.interceptors.request.use(
                    (config) => {
                        console.log('üîç Axios Request Config:', config);
                        console.log('üîç URL completa:', `${config.baseURL}${config.url}`);
                        return config;
                    },
                    (error) => {
                        console.error('üîç Axios Request Error:', error);
                        return Promise.reject(error);
                    }
                );
                
                const response = await axiosInstance.post('/auth/login', TEST_CREDENTIALS);
                
                console.log('‚úÖ Axios Response:', response);
                showResult(`‚úÖ SUCESSO com axios!\n\nStatus: ${response.status}\nURL: ${response.config.url}\nBase URL: ${response.config.baseURL}\nToken: ${response.data.accessToken ? 'Recebido' : 'N√£o recebido'}\nUsu√°rio: ${response.data.user?.nome || 'N√£o encontrado'}\n\nResposta completa:\n${JSON.stringify(response.data, null, 2)}`);
                
            } catch (error) {
                console.error('‚ùå Erro axios:', error);
                const errorMsg = error.response 
                    ? `HTTP ${error.response.status}: ${JSON.stringify(error.response.data, null, 2)}`
                    : `Rede: ${error.message}`;
                showResult(`‚ùå ERRO AXIOS\n\n${errorMsg}\n\nErro completo:\n${JSON.stringify(error, null, 2)}`);
            }
        }

        // Teste de CORS
        async function testCors() {
            showResult('üîÑ Testando CORS...');
            
            try {
                console.log('üß™ Testando CORS com OPTIONS');
                
                const response = await fetch(LOGIN_ENDPOINT, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type',
                    }
                });
                
                console.log('üìä CORS Response:', response);
                console.log('üìä CORS Headers:', [...response.headers.entries()]);
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                };
                
                showResult(`üîç TESTE DE CORS\n\nStatus: ${response.status}\nOrigin permitida: ${corsHeaders['Access-Control-Allow-Origin'] || 'N√£o definida'}\nM√©todos permitidos: ${corsHeaders['Access-Control-Allow-Methods'] || 'N√£o definidos'}\nHeaders permitidos: ${corsHeaders['Access-Control-Allow-Headers'] || 'N√£o definidos'}\n\nTodos os headers CORS:\n${JSON.stringify(corsHeaders, null, 2)}`);
                
            } catch (error) {
                console.error('üí• Erro CORS:', error);
                showResult(`üí• ERRO CORS\n\nMensagem: ${error.message}\nDetalhes: ${JSON.stringify(error, null, 2)}`);
            }
        }

        // Inicializar
        updateEnvInfo();
        console.log('üöÄ Debug page carregada!');
        console.log('üîß Configura√ß√µes:', { API_BASE_URL, LOGIN_ENDPOINT, TEST_CREDENTIALS: { ...TEST_CREDENTIALS, senha: '***' } });
    </script>
</body>
</html>